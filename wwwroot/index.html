<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>PDU CID Monitor</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>PDU CID Monitor</h1>
        <span id="conn-status" class="disconnected">연결 끊김</span>
        <span id="timestamp"></span>
    </header>

    <div class="main-layout">
        <!-- 왼쪽: 회로 흐름도 SVG -->
        <div class="diagram-area">
            <svg id="flow-svg" viewBox="0 0 1100 680" xmlns="http://www.w3.org/2000/svg">

                <defs>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="3" result="blur" />
                        <feMerge><feMergeNode in="blur" /><feMergeNode in="SourceGraphic" /></feMerge>
                    </filter>
                </defs>

                <!-- ======== N- RETURN LINES (background, always dim) ======== -->
                <line class="wire-return" x1="555" y1="555" x2="555" y2="610" />
                <line class="wire-return" x1="725" y1="555" x2="725" y2="610" />
                <line class="wire-return" x1="895" y1="480" x2="895" y2="610" />

                <!-- ======== WIRE PATHS ======== -->
                <!-- Battery1 P+ → R2(BAT_S) → P+ Bus -->
                <g id="path-series" class="wire-group off">
                    <polyline class="wire wire-pos" points="200,145 300,145" />
                    <polyline class="wire wire-pos" points="360,145 440,145 440,250" />
                    <polyline class="flow flow-pos" points="200,145 300,145" />
                    <polyline class="flow flow-pos" points="360,145 440,145 440,250" />
                </g>

                <!-- Battery2 P+ → R3(BAT_PPC) → P+ Bus -->
                <g id="path-parallel" class="wire-group off">
                    <polyline class="wire wire-pos" points="200,375 300,375" />
                    <polyline class="wire wire-pos" points="360,375 440,375 440,260" />
                    <polyline class="flow flow-pos" points="200,375 300,375" />
                    <polyline class="flow flow-pos" points="360,375 440,375 440,260" />
                </g>

                <!-- P+ Bus → A point → R1(DC_P) → DC Connector -->
                <g id="path-dc-pos" class="wire-group off">
                    <polyline class="wire wire-pos" points="600,250 600,70" />
                    <polyline class="wire wire-pos" points="614,70 700,70" />
                    <polyline class="wire wire-pos" points="760,70 880,70" />
                    <polyline class="flow flow-pos" points="600,250 600,70" />
                    <polyline class="flow flow-pos" points="614,70 700,70" />
                    <polyline class="flow flow-pos" points="760,70 880,70" />
                </g>

                <!-- P+ Bus → R4(OBC) → OBC -->
                <g id="path-obc" class="wire-group off">
                    <polyline class="wire wire-pos" points="555,260 555,289" />
                    <polyline class="wire wire-pos" points="555,311 555,410" />
                    <polyline class="flow flow-pos" points="555,260 555,289" />
                    <polyline class="flow flow-pos" points="555,311 555,410" />
                </g>

                <!-- OBC → AC -->
                <g id="path-obc-ac" class="wire-group off">
                    <line class="wire wire-pos" x1="555" y1="480" x2="555" y2="505" />
                    <line class="flow flow-pos" x1="555" y1="480" x2="555" y2="505" />
                </g>

                <!-- P+ Bus → R5(INV) → Inverter -->
                <g id="path-inv" class="wire-group off">
                    <polyline class="wire wire-pos" points="725,260 725,289" />
                    <polyline class="wire wire-pos" points="725,311 725,410" />
                    <polyline class="flow flow-pos" points="725,260 725,289" />
                    <polyline class="flow flow-pos" points="725,311 725,410" />
                </g>

                <!-- Inverter → Load -->
                <g id="path-inv-load" class="wire-group off">
                    <line class="wire wire-pos" x1="725" y1="480" x2="725" y2="505" />
                    <line class="flow flow-pos" x1="725" y1="480" x2="725" y2="505" />
                </g>

                <!-- P+ Bus → R6(LDC) → LDC -->
                <g id="path-ldc" class="wire-group off">
                    <polyline class="wire wire-pos" points="895,260 895,289" />
                    <polyline class="wire wire-pos" points="895,311 895,410" />
                    <polyline class="flow flow-pos" points="895,260 895,289" />
                    <polyline class="flow flow-pos" points="895,311 895,410" />
                </g>

                <!-- Battery1 N- → N- Bus -->
                <g id="path-b1n" class="wire-group off">
                    <polyline class="wire wire-neg" points="200,175 230,175 230,610" />
                    <polyline class="flow flow-neg" points="200,175 230,175 230,610" />
                </g>

                <!-- Battery2 N- → N- Bus -->
                <g id="path-b2n" class="wire-group off">
                    <polyline class="wire wire-neg" points="200,405 270,405 270,610" />
                    <polyline class="flow flow-neg" points="200,405 270,405 270,610" />
                </g>

                <!-- N- Bus → R7(DC_N) → DC Connector N- -->
                <g id="path-dc-neg" class="wire-group off">
                    <polyline class="wire wire-neg" points="860,615 860,615" />
                    <polyline class="wire wire-neg" points="920,615 960,615 960,105" />
                    <polyline class="flow flow-neg" points="920,615 960,615 960,105" />
                </g>

                <!-- ======== BUS BARS ======== -->
                <rect id="bus-pos" class="bus-bar bus-pos-bar" x="440" y="249" width="530" height="12" rx="4" />
                <text class="bus-label" x="705" y="245">P+ BUS</text>

                <rect id="bus-neg" class="bus-bar bus-neg-bar" x="220" y="609" width="750" height="12" rx="4" />
                <text class="bus-label-neg" x="595" y="643">N- BUS</text>

                <!-- ======== COMPONENT BOXES ======== -->
                <!-- Battery1 -->
                <rect class="comp-box" x="40" y="100" width="160" height="90" rx="8" />
                <text class="comp-label" x="120" y="128">Battery 1</text>
                <text id="txt-b1v" class="comp-value" x="120" y="155">0 V</text>
                <text id="txt-b1a" class="comp-value-sub" x="120" y="178">0 A</text>

                <!-- Battery2 -->
                <rect class="comp-box" x="40" y="330" width="160" height="90" rx="8" />
                <text class="comp-label" x="120" y="358">Battery 2</text>
                <text id="txt-b2v" class="comp-value" x="120" y="385">0 V</text>
                <text id="txt-b2a" class="comp-value-sub" x="120" y="408">0 A</text>

                <!-- Mode badge (between batteries) -->
                <rect id="svg-mode-bg" class="mode-badge-bg" x="50" y="230" width="140" height="30" rx="6" />
                <text id="svg-mode" class="mode-badge-text" x="120" y="250">대기</text>

                <!-- Total Voltage (on bus) -->
                <rect class="total-badge-bg" x="460" y="225" width="120" height="24" rx="5" />
                <text class="total-label" x="483" y="241">Total</text>
                <text id="txt-total" class="total-value" x="555" y="242">0 V</text>

                <!-- DC Connector -->
                <rect id="box-dc" class="comp-box" x="880" y="35" width="150" height="70" rx="8" />
                <text class="comp-label" x="955" y="62">DC 급속충전</text>
                <text class="comp-value-sub" x="955" y="82">커넥터</text>

                <!-- OBC -->
                <rect id="box-obc" class="comp-box" x="485" y="410" width="140" height="70" rx="8" />
                <text class="comp-label" x="555" y="438">OBC</text>
                <text id="txt-obc" class="comp-value-sub" x="555" y="462">0V / 0A</text>

                <!-- AC Input -->
                <rect id="box-ac" class="comp-box comp-ac" x="485" y="505" width="140" height="50" rx="8" />
                <text class="comp-label" x="555" y="528">AC Input</text>
                <text id="txt-ac" class="comp-value-sub" x="555" y="545">0 V</text>

                <!-- Inverter -->
                <rect id="box-inv" class="comp-box" x="655" y="410" width="140" height="70" rx="8" />
                <text class="comp-label" x="725" y="438">Inverter</text>
                <text class="comp-value-sub" x="725" y="462">구동부</text>

                <!-- Load -->
                <rect id="box-load" class="comp-box" x="655" y="505" width="140" height="50" rx="8" />
                <text class="comp-label" x="725" y="528">Load</text>
                <text class="comp-value-sub" x="725" y="545">부하</text>

                <!-- LDC -->
                <rect id="box-ldc" class="comp-box" x="825" y="410" width="140" height="70" rx="8" />
                <text class="comp-label" x="895" y="438">LDC</text>
                <text id="txt-ldc" class="comp-value-sub" x="895" y="462">0V / 0A</text>

                <!-- ======== RELAY BOXES (on top of wires) ======== -->
                <!-- R1: DC_P -->
                <g id="rly-DC_P" class="relay off" transform="translate(700,59)">
                    <rect class="relay-bg" width="60" height="22" rx="4" />
                    <text class="relay-text" x="30" y="15">R1</text>
                </g>
                <text class="relay-name" x="730" y="54">DC_P</text>

                <!-- R2: BAT_S -->
                <g id="rly-BAT_S" class="relay off" transform="translate(300,134)">
                    <rect class="relay-bg" width="60" height="22" rx="4" />
                    <text class="relay-text" x="30" y="15">R2</text>
                </g>
                <text class="relay-name" x="330" y="130">BAT_S</text>

                <!-- R3: BAT_PPC -->
                <g id="rly-BAT_PPC" class="relay off" transform="translate(300,364)">
                    <rect class="relay-bg" width="60" height="22" rx="4" />
                    <text class="relay-text" x="30" y="15">R3</text>
                </g>
                <text class="relay-name" x="330" y="360">BAT_PPC</text>

                <!-- R4: OBC -->
                <g id="rly-OBC" class="relay off" transform="translate(530,289)">
                    <rect class="relay-bg" width="50" height="22" rx="4" />
                    <text class="relay-text" x="25" y="15">R4</text>
                </g>
                <text class="relay-name" x="555" y="285">OBC</text>

                <!-- R5: INV -->
                <g id="rly-INV" class="relay off" transform="translate(700,289)">
                    <rect class="relay-bg" width="50" height="22" rx="4" />
                    <text class="relay-text" x="25" y="15">R5</text>
                </g>
                <text class="relay-name" x="725" y="285">INV</text>

                <!-- R6: LDC -->
                <g id="rly-LDC" class="relay off" transform="translate(870,289)">
                    <rect class="relay-bg" width="50" height="22" rx="4" />
                    <text class="relay-text" x="25" y="15">R6</text>
                </g>
                <text class="relay-name" x="895" y="285">LDC</text>

                <!-- R7: DC_N -->
                <g id="rly-DC_N" class="relay off" transform="translate(860,604)">
                    <rect class="relay-bg" width="60" height="22" rx="4" />
                    <text class="relay-text" x="30" y="15">R7</text>
                </g>
                <text class="relay-name" x="890" y="600">DC_N</text>

                <!-- ======== NODE POINTS ======== -->
                <!-- A point -->
                <g class="node-group">
                    <circle class="node-point" cx="600" cy="70" r="14" />
                    <text class="node-label" x="600" y="75">A</text>
                    <title>
                        A 포인트: DC 급속충전 분기점
                        P+ BUS에서 R1(DC_P) 릴레이를 거쳐
                        DC 급속충전 커넥터로 연결되는 지점
                    </title>
                </g>

                <!-- B point (on bus) -->
                <g class="node-group">
                    <circle class="node-point" cx="440" cy="255" r="14" />
                    <text class="node-label" x="440" y="260">B</text>
                    <title>
                        B 포인트: 직렬/병렬 전환 분기점
                        Battery1(R2)과 Battery2(R3)의 전류가 합류하고
                        OBC(R4), Inverter(R5), LDC(R6)로 분배되는 중심 노드
                    </title>
                </g>


                <!-- ======== TERMINAL LABELS ======== -->
                <text class="terminal-pos" x="207" y="142">P+</text>
                <text class="terminal-neg" x="207" y="180">N-</text>
                <text class="terminal-pos" x="207" y="372">P+</text>
                <text class="terminal-neg" x="207" y="410">N-</text>

                <!-- DC Connector terminals -->
                <text class="terminal-pos" x="875" y="68">P+</text>
                <text class="terminal-neg" x="955" y="110">N-</text>

            </svg>
        </div>

        <!-- 오른쪽: 데이터 패널 -->
        <div class="data-panel">
            <!-- 연결 모드 -->
            <div class="card card-mode">
                <div id="mode-display" class="mode-box">대기</div>
            </div>

            <!-- 배터리 -->
            <div class="card">
                <h3>배터리</h3>
                <div class="data-grid-2col">
                    <div class="data-cell">
                        <span class="data-label">Batt1 전압</span>
                        <span id="val-b1v" class="val">0 V</span>
                    </div>
                    <div class="data-cell">
                        <span class="data-label">Batt2 전압</span>
                        <span id="val-b2v" class="val">0 V</span>
                    </div>
                    <div class="data-cell">
                        <span class="data-label">Batt1 전류</span>
                        <span id="val-b1a" class="val">0 A</span>
                    </div>
                    <div class="data-cell">
                        <span class="data-label">Batt2 전류</span>
                        <span id="val-b2a" class="val">0 A</span>
                    </div>
                </div>
                <div class="data-row total-row">
                    <span>Total Voltage</span>
                    <span id="val-tv" class="val val-total">0 V</span>
                </div>
            </div>

            <!-- 릴레이 상태 -->
            <div class="card">
                <h3>릴레이 상태</h3>
                <div class="relay-section">
                    <div class="relay-section-label">직렬</div>
                    <div class="relay-row">
                        <div class="rly-item"><span class="rly-led off" id="led-BAT_S"></span>BAT_S</div>
                        <div class="rly-item"><span class="rly-led off" id="led-BAT_PC"></span>BAT_PC</div>
                        <div class="rly-item"><span class="rly-led off" id="led-BAT_NC"></span>BAT_NC</div>
                    </div>
                </div>
                <div class="relay-section">
                    <div class="relay-section-label">병렬</div>
                    <div class="relay-row">
                        <div class="rly-item"><span class="rly-led off" id="led-BAT_PPC"></span>BAT_PPC</div>
                        <div class="rly-item"><span class="rly-led off" id="led-BAT_PNC"></span>BAT_PNC</div>
                        <div class="rly-item"><span class="rly-led off" id="led-BAT_PP"></span>BAT_PP</div>
                    </div>
                </div>
                <div class="relay-section">
                    <div class="relay-section-label">출력</div>
                    <div class="relay-row">
                        <div class="rly-item"><span class="rly-led off" id="led-DC_P"></span>DC_P</div>
                        <div class="rly-item"><span class="rly-led off" id="led-DC_N"></span>DC_N</div>
                        <div class="rly-item"><span class="rly-led off" id="led-OBC"></span>OBC</div>
                        <div class="rly-item"><span class="rly-led off" id="led-LDC"></span>LDC</div>
                        <div class="rly-item"><span class="rly-led off" id="led-INV"></span>INV</div>
                    </div>
                </div>
            </div>

            <!-- OBC -->
            <div class="card">
                <h3>OBC (충전기)</h3>
                <div class="data-row"><span>충전 전압</span><span id="val-obc-v" class="val">0 V</span></div>
                <div class="data-row"><span>충전 전류</span><span id="val-obc-a" class="val">0 A</span></div>
                <div class="data-row"><span>온도</span><span id="val-obc-t" class="val">0 &#8451;</span></div>
                <div class="data-row"><span>AC R/S/T</span><span id="val-ac" class="val">0 / 0 / 0 V</span></div>
            </div>

            <!-- LDC -->
            <div class="card">
                <h3>LDC (DC-DC)</h3>
                <div class="data-row"><span>출력 전압</span><span id="val-ldc-v" class="val">0 V</span></div>
                <div class="data-row"><span>출력 전류</span><span id="val-ldc-a" class="val">0 A</span></div>
                <div class="data-row"><span>온도</span><span id="val-ldc-t" class="val">0 &#8451;</span></div>
                <div class="data-row"><span>동작</span><span id="val-ldc-work" class="val">OFF</span></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
